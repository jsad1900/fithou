---
layout: post
title:  "PVOI14_4 - Chữ M"
categories: [binary-index-tree, dp, sortings, binary-search, data-structure]
code: PVOI14_4
src: PVOI14_4.cpp
---

Bài này bản chất là QHĐ : Gọi F[i][j] là chiều dài dài nhất đến đèn thứ i với đèn i là đèn cuối cùng trong dãy phần thứ j. (1 <= i <= n && 1 <= j <= 4).

Dễ thấy F[i][1] = max(F[j][1]) với j < i và a[j] < a[i] (tương tự dãy con tăng dài nhất)

Còn F[i][j] (j > 1) thì có hai cách lựa chọn, thứ nhất nó là bắt đầu của dãy j-1 (ví dụ dãy đang lên tới j thì i là đèn bắt đầu đi xuống, và ngược lại). Trường hợp thứ hai là nó tiếp tục của một dãy j (ví dụ đang xuống thì tiếp tục xuống, tương tự như đi lên).

Do đó F[i][j] = max(F[k][j], F[k][j-1]) (k < i và a[k] thỏa mãn a[i]) (dãy 2, 4 thì a[k] > a[j], do đang đi xuống hoặc bắt đầu xuống, còn dãy 3 thì a[k] < a[j]).

Tất cả những điều trên đều dễ dàng thực hiện bằng BIT. Do đó bài toán có

ĐPT : O(NlogN).

Chú ý khi cập nhật những phần tử đầu tiên của một dãy 2, dãy 3, dãy 4. (F[2][i_bắt_đầu] >= 3, F[3][i_bắt_đầu] >= 4, ... 